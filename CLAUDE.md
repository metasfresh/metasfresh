# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## About metasfresh

metasfresh is a Free and Open Source ERP System with a 3-tier architecture featuring:
- Java backend with Spring Boot and REST APIs  
  - The java code makes a lot of use of lombok! 
- ReactJS/Redux frontend (Web UI)
- PostgreSQL database
- Docker-based deployment and CI/CD

### Openrewrite
The openrewrite recipe [Migrate to Java 21](https://docs.openrewrite.org/recipes/java/migrate/upgradetojava21) was applied to this code-base

to re-run it, you can do
```
cd ./backend && mvn --settings=../misc/dev-support/maven/settings.xml -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes=org.openrewrite.java.migrate.UpgradeToJava21 -Drewrite.exportDatatables=true
```

## Build Commands

### Backend (Java/Maven)

Java classes that start with `I_` or `X_` were generated by a tool refer to particular DB-tables.

```bash
# Build the entire code-base, which includes mostly the backend by using the bootstrap script
# first CD into this folder
cd ./misc/dev-support/bootstrap-scripts 
# then run this script
./mvn_build.sh


### Frontend (React/Node.js)
```bash
cd frontend/

# Install dependencies
yarn install

# Development server
yarn start

# Build for production
yarn build-prod

# Run tests
yarn test

# Run tests in watch mode
yarn test:watch

# Lint code
yarn lint

# Fix linting issues
yarn lintfix
```

### E2E Testing (Cypress)

cypress testing is defunct and plays no role currently. please ignore it.

```bash
cd e2e/

# Open Cypress UI
yarn cypress:open

# Run headless tests
./run_cypress.sh
```

## Docker Build & Deployment

The project uses Docker extensively for builds and deployments:

```bash
# Build backend images
docker buildx build --file docker-builds/Dockerfile.backend .

# Build frontend images  
docker buildx build --file docker-builds/Dockerfile.frontend .

# Start full stack locally
cd docker-builds/compose/
docker compose up
```

## Architecture Overview

### Backend Structure
- **Modular Maven architecture** with 100+ modules in `backend/`
- **Core modules**: `de.metas.business`, `de.metas.adempiere.adempiere`
- **Web API**: `metasfresh-webui-api` (Spring Boot REST API)
- **Domain modules**: contracts, manufacturing, material planning, payments, etc.
- **Vertical modules**: healthcare, pharma industry-specific functionality

### Parent-pom and common libraries

The central parent-pom for the whole repo is `misc/parent-pom/pom.xml`
There is commonly used java-code in `misc/de-metas-common`

### Frontend Structure
- **React 16** with Redux for state management
- **Component-based architecture** in `frontend/src/`
- **REST API integration** with backend
- **Mobile-responsive** design

### Key Technologies
- **Backend**: Java 21, Spring Boot 2.4, Maven, JUnit
- **Frontend**: React 16, Redux, Webpack, Jest
- **Database**: PostgreSQL with migration scripts
- **Message Queue**: RabbitMQ
- **Search**: Elasticsearch
- **Testing**: JUnit (backend), Jest (frontend), Cucumber (integration), Cypress (E2E)

## Testing Strategy

### Unit Tests
- **Backend**: JUnit tests in each module (`src/test/java/`)
- **Frontend**: Jest tests in `frontend/src/__tests__/`

### Integration Tests  
- **Cucumber tests** in `backend/de.metas.cucumber/`
- **API tests** verify REST endpoints

### E2E Tests

- **Cypress tests** in `e2e/cypress/integration/`
  - cypress testing is defunct and plays no role currently. please ignore it. 
- Test complete user workflows across the application

## Development Workflow

### Backend Development
1. Each feature typically spans multiple Maven modules
2. Generate database models using launch configurations (`.launch` files)
3. Follow existing patterns for services, repositories, and REST controllers
4. Use Spring Boot profiles for configuration

### Frontend Development  
1. Component development in `frontend/src/components/`
2. Redux actions/reducers for state management
3. API integration through axios HTTP client
4. Hot reloading available during development

### Database Changes
- **Migration scripts** SQL-files managed in `backend/de.metas.migration/` and many other folders
- Use provided tooling for schema changes
- Test migrations in Docker containers

## CI/CD Pipeline

The `.github/workflows/cicd.yaml` defines a comprehensive pipeline:
- **Java builds** with Maven in Docker
- **Frontend builds** and tests
- **Docker image creation** for all components  
- **JUnit, Jest, Cucumber, and Cypress test execution**
- **Docker image publishing** to registry
- **Health checks** of deployed services

## Common Commands for Development

```bash
# Quick backend build
cd backend && mvn clean install -DskipTests

# Frontend development server
cd frontend && yarn start

# Run specific test suite
cd backend && mvn test -pl de.metas.business

# Build Docker images locally
docker buildx build --file docker-builds/Dockerfile.backend .

# Check Docker compose stack health
cd docker-builds/compose && docker compose ps
```

## Module Dependencies

The backend follows a layered dependency structure:
- **Base layer**: `de.metas.adempiere.adempiere`, `de.metas.util`
- **Business layer**: `de.metas.business`, `de.metas.async`  
- **Domain layer**: contracts, manufacturing, material, payment modules
- **UI layer**: `metasfresh-webui-api`, `de.metas.ui.web.base`
- **Integration layer**: EDI, external systems, REST APIs

When modifying code, understand the dependency hierarchy to avoid circular dependencies and ensure proper layering.