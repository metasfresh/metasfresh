# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## About metasfresh

metasfresh is a Free and Open Source ERP System with a 3-tier architecture featuring:
- Java backend with Spring Boot and REST APIs  
  - The java code makes a lot of use of lombok! 
- ReactJS/Redux frontend (Web UI)
- PostgreSQL database
- Docker-based deployment and CI/CD

### Ongoing code migration

Important: in this branch we are in the process of migrating the code to java-21 and spring-boot 3.5.0.
All problems with compiling the code and running tests are related to this.

## Helpful tips around Build Commands

### `settings.xml`
When using with maven, the settings.xml file which is located at the relative path `./misc/dev-support/maven/settings.xml` needs to be used. 
That path is relative to the `metasfresh` folder.

**Important**, you need to override the local repository because you are running in the windows-11 wsl ubuntu app.
Be sure to run maven with 
`-Dmaven.repo.local=/mnt/c/Users/tobia/.m2/new_dawn_uat_java21`

If you run into problems with local paths, please explain the problem and ask me for help.

### The git-plugin

For some reason, the git plugin fails when you run maven.
Skip it by appending the parameter `-Dmaven.gitcommitid.skip=true` to the `mvn` command line 

### maven help goal

Whenever you are asked to fix a maven plugin config in a `pom.xml`, try to read the plugin's docu.
With most plugins, you can do so by invoking the plugin's `help` goal.
For example:
```bash
mvn org.codehaus.mojo:jaxb2-maven-plugin:3.3.0:help -Ddetail=true
```

### Ask for help with missing modules

Oftentimes you need to build a certain module and run into problems because other metasfresh-modules were not yet built.
In such cases ask me to provide them.

## Backend (Java/Maven)

### Generated Model Classes
Java classes that start with `I_` or `X_` were generated by a tool refer to particular DB-tables.

### Script to Compile everything

```bash
# Build the entire code-base, which includes mostly the backend by using the bootstrap script
# first cd into this folder
cd ./misc/dev-support/bootstrap-scripts 
# then run this script
./mvn_build.sh
```

If you read the script, you also see which parts need to be build before the `backend` can be build

### Frontend (React/Node.js)
```bash
cd frontend/

# Install dependencies
yarn install

# Development server
yarn start

# Build for production
yarn build-prod

# Run tests
yarn test

# Run tests in watch mode
yarn test:watch

# Lint code
yarn lint

# Fix linting issues
yarn lintfix
```

### E2E Testing (Cypress)

cypress testing is defunct and plays no role currently. please ignore it.

## Docker Build & Deployment

The project uses Docker extensively for builds and deployments:

```bash
# Build backend images
docker buildx build --file docker-builds/Dockerfile.backend .

# Build frontend images  
docker buildx build --file docker-builds/Dockerfile.frontend .

# Start full stack locally
cd docker-builds/compose/
docker compose up
```

## Architecture Overview

### Backend Structure
- **Modular Maven architecture** with 100+ modules in `backend/`
- **Core modules**: `de.metas.business`, `de.metas.adempiere.adempiere`
- **Web API**: `metasfresh-webui-api` (Spring Boot REST API)
- **Domain modules**: contracts, manufacturing, material planning, payments, etc.
- **Vertical modules**: healthcare, pharma industry-specific functionality

### Parent-pom and common libraries

The central parent-pom for the whole repo is `./misc/parent-pom/pom.xml`
There is commonly used java-code in `./misc/de-metas-common`

Both paths are relative to the `metasfresh` folder.

Important: both parent-pom and commonly used java-code need to be installed to the local maven repo in order to build any other maven artifacts.

### Frontend Structure
- **React 16** with Redux for state management
- **Component-based architecture** in `frontend/src/`
- **REST API integration** with backend
- **Mobile-responsive** design

### Key Technologies
- **Backend**: Java 21, Spring Boot 3.5.0, Maven, JUnit
- **Frontend**: React 16, Redux, Webpack, Jest
- **Database**: PostgreSQL with migration scripts
- **Message Queue**: RabbitMQ
- **Search**: Elasticsearch
- **Testing**: JUnit (backend), Jest (frontend), Cucumber (integration), Cypress (E2E)

## Testing Strategy

### Unit Tests
- **Backend**: JUnit tests in each module (`src/test/java/`)
- **Frontend**: Jest tests in `frontend/src/__tests__/`

### Integration Tests  
- **Cucumber tests** in `backend/de.metas.cucumber/`
- **API tests** verify REST endpoints

## Development Workflow

### Backend Development
1. Each feature typically spans multiple Maven modules
2. Generate database models using launch configurations (`.launch` files)
3. Follow existing patterns for services, repositories, and REST controllers
4. Use Spring Boot profiles for configuration

### Frontend Development  
1. Component development in `frontend/src/components/`
2. Redux actions/reducers for state management
3. API integration through axios HTTP client
4. Hot reloading available during development

### Database Changes
- **Migration scripts** SQL-files managed in `backend/de.metas.migration/` and many other folders
- Use provided tooling for schema changes
- Test migrations in Docker containers

## CI/CD Pipeline

The `.github/workflows/cicd.yaml` defines a comprehensive pipeline:
- **Java builds** with Maven in Docker
- **Frontend builds** and tests
- **Docker image creation** for all components  
- **JUnit, Jest, Cucumber, and Cypress test execution**
- **Docker image publishing** to registry
- **Health checks** of deployed services

## Common Commands for Development


## Module Dependencies

The backend follows a layered dependency structure:
- **Base layer**: `de.metas.adempiere.adempiere`, `de.metas.util`
- **Business layer**: `de.metas.business`, `de.metas.async`  
- **Domain layer**: contracts, manufacturing, material, payment modules
- **UI layer**: `metasfresh-webui-api`, `de.metas.ui.web.base`
- **Integration layer**: EDI, external systems, REST APIs

When modifying code, understand the dependency hierarchy to avoid circular dependencies and ensure proper layering.

## Tips for using local tools

To recursively get all files that end with `.java` and contain the string `import javax.`, you can use this command: 
```bash
find src/ -name "*.java" -print0 | xargs -0 grep -l "import javax\."
```

on the other hadn, the following does **not** work:
`find . -name "pom.xml" -exec grep -l "jaxb\|wsimport\|wsdl" {} \;`

this fails with the error-message "Error: find: missing argument to `-exec'"